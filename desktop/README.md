# RAG Desktop Client

Этот проект реализует настольный клиент для сервиса RAG (Retrieval Augmented Generation), созданный с использованием фреймворка Electron. Он предоставляет удобный пользовательский интерфейс для взаимодействия с бэкендом RAG, поддерживает загрузку файлов, управление чат-сессиями и проведение контекстных диалогов на базе большой языковой модели (LLM) через OpenRouter.

## Возможности

* **Загрузка файлов:** Лёгкая загрузка PDF, DOCX и Markdown-файлов в сервис RAG для последующей обработки и добавления в векторное хранилище.
* **Множественные чат-сессии:** Создание и управление несколькими независимыми чатами с возможностью переключения между ними.
* **История чата (в рамках сессии):** Каждая чат-сессия сохраняет свою историю, которая передаётся в LLM для сохранения контекста.
* **Интерфейс, как у ChatGPT:** Привычный и интуитивно понятный интерфейс.
* **Модульная архитектура:** Чёткое разделение кода на модули для удобства поддержки и масштабирования.

## Архитектура

Приложение реализовано по клиент-серверной архитектуре: настольное приложение на Electron выступает в роли клиента, взаимодействующего с сервером RAG на базе FastAPI.

```
+---------------------+           +--------------------------+
|                     |           |                          |
|  RAG Desktop Client |           |  Сервис RAG (бэкенд)     |
|   (Electron App)    |           |                          |
|                     |           |   - FastAPI              |
|   - Renderer Process| <-------> |   - Обработка файлов     |
|   - Main Process    |           |   - Векторное хранилище  |
|                     |           |   - Интеграция с LLM     |
+---------------------+           +--------------------------+
       |
       | IPC-связь
       V
+---------------------+
|                     |
|  Файловая система   |
| (временное хранилище)|
+---------------------+
```

### Процессы Electron

* **Main Process (основной процесс):** Отвечает за создание и управление окнами, системные события, привилегированные операции (доступ к файловой системе, диалоги). Также осуществляет защищённую передачу данных между рендер-процессом и внешними ресурсами.
* **Renderer Process (рендер-процесс):** Запускается для каждого окна браузера и содержит UI (HTML, CSS, JS). Здесь происходит обработка пользовательских взаимодействий.

### Поток взаимодействия

1. **Renderer → Main:** Действия пользователя (например, «Загрузить файл», «Отправить сообщение») отправляют IPC-сообщения в основной процесс.
2. **Main → Бэкенд:** Основной процесс обрабатывает сообщение (например, читает файл) и отправляет HTTP-запрос к API сервиса RAG.
3. **Бэкенд → Main:** Сервис обрабатывает запрос и отправляет HTTP-ответ.
4. **Main → Renderer:** Основной процесс передаёт ответ (или его обработанный вариант) обратно в рендер-процесс через IPC.
5. **Renderer обновляет UI:** Интерфейс обновляется на основе полученных данных.

## Структура проекта

```
rag_desktop_client/
├── main.js                 # Точка входа основного процесса Electron
├── package.json            # Зависимости и скрипты проекта
├── src/
│   ├── index.html          # Главный HTML-файл для рендер-процесса
│   ├── renderer.js         # Точка входа рендер-процесса (логика UI)
│   ├── styles.css          # Стили приложения
│   ├── modules/            # Компоненты UI и логика
│   │   ├── chat/
│   │   │   ├── chat.js     # Логика компонента чата
│   │   │   ├── chat.css    # Стили компонента чата
│   │   │   └── README.md   # README модуля
│   │   ├── file_upload/
│   │   │   ├── file_upload.js # Логика загрузки файлов
│   │   │   └── README.md   # README модуля
│   │   ├── api_client/
│   │   │   ├── api_client.js # Связь с сервисом RAG
│   │   │   └── README.md   # README модуля
│   │   └── chat_manager/
│   │       ├── chat_manager.js # Управление чатами и историей
│   │       └── README.md   # README модуля
├── .env.example            # Пример файла переменных окружения (например, URL бэкенда)
└── README.md               # Этот файл
```

## Установка и настройка

1. **Клонируйте репозиторий:**

   ```bash
   # git clone <repository_url>
   # cd rag_desktop_client
   ```

2. **Установите зависимости Node.js:**

   ```bash
   npm install
   ```

3. **Настройте URL бэкенда:**
   Создайте файл `.env` в корне проекта и добавьте в него адрес запущенного бэкенда RAG:

   ```
   RAG_SERVICE_URL="http://127.0.0.1:8000"
   ```

   *Убедитесь, что сервис RAG запущен, согласно его `README.md`.*

## Запуск приложения

Для запуска приложения Electron выполните:

```bash
npm start
```

## Как пользоваться

1. **Запустите сервис RAG:** Убедитесь, что он доступен по указанному в `.env` URL (по умолчанию: `http://127.0.0.1:8000`).
2. **Запустите настольный клиент:** Выполните `npm start` в каталоге `rag_desktop_client`.
3. **Загрузите документы:** Используйте кнопку «Upload File» для отправки PDF, DOCX или Markdown-файлов в RAG.
4. **Создайте новый чат:** Запустите новую чат-сессию.
5. **Задайте вопрос LLM:** Введите сообщение в чат — загруженные документы будут использованы в качестве контекста.
6. **Просмотрите ответы и источники:** Ответ LLM будет показан вместе с частями документа, использованными при генерации.
